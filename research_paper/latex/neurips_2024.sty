% neurips_2025.sty - NeurIPS 2025 Style File
% Two-column document with full-width title and abstract
% Fixed to properly handle math mode in abstract

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{neurips_2025}[2025/01/01 NeurIPS 2025 submission style]

% Options
\newif\if@final\@finalfalse
\newif\if@preprint\@preprintfalse
\DeclareOption{final}{\@finaltrue}
\DeclareOption{preprint}{\@preprinttrue}
\ProcessOptions\relax

% Page layout - NeurIPS standard margins
\RequirePackage[
    letterpaper,
    left=1in,
    right=1in,
    top=1in,
    bottom=1in
]{geometry}

% Column settings for two-column mode
\setlength{\columnsep}{0.25in}

% Typography
\RequirePackage{times}
\RequirePackage[T1]{fontenc}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{mathtools}

% No date by default
\date{}

% Line spacing
\linespread{1.0}

% Storage for abstract content
\newsavebox{\@abstractbox}

% Custom abstract environment - saves content to a box
\renewenvironment{abstract}{%
    \global\setbox\@abstractbox=\vbox\bgroup
    \small
}{%
    \egroup
}

% Custom maketitle - outputs title, author, AND abstract together in twocolumn[]
\def\@maketitle{%
    \twocolumn[%
        \begin{center}%
            \vskip 0.1in%
            {\LARGE \bfseries \@title \par}%
            \vskip 0.25in%
            {\large
                \lineskip 0.5em%
                \begin{tabular}[t]{c}%
                    \@author
                \end{tabular}\par}%
        \end{center}%
        \vskip 0.15in%
        \centerline{\large\bfseries Abstract}%
        \vspace{0.5ex}%
        \begin{center}%
        \begin{minipage}{0.9\textwidth}%
            \usebox{\@abstractbox}%
        \end{minipage}%
        \end{center}%
        \vskip 0.1in%
    ]%
}

% Section formatting - NeurIPS standard
\RequirePackage{titlesec}
\titleformat{\section}{\normalfont\large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\normalsize\bfseries}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\normalfont\normalsize\itshape}{\thesubsubsection}{1em}{}

\titlespacing*{\section}{0pt}{2.5ex plus 1ex minus .2ex}{1.5ex plus .2ex}
\titlespacing*{\subsection}{0pt}{2ex plus 0.5ex minus .2ex}{1ex plus .2ex}
\titlespacing*{\subsubsection}{0pt}{1.5ex plus 0.5ex minus .2ex}{0.75ex plus .2ex}

% Paragraph settings
\setlength{\parindent}{1em}
\setlength{\parskip}{0pt plus 0.5ex}

% List settings - compact for two-column
\RequirePackage{enumitem}
\setlist{topsep=3pt, itemsep=1pt, parsep=1pt, leftmargin=*}
\setlist[itemize]{label=\textbullet}
\setlist[enumerate]{label=(\arabic*)}

% Figure/table settings
\RequirePackage{graphicx}
\RequirePackage{float}
\RequirePackage{caption}
\RequirePackage{subcaption}
\captionsetup{
    font=small,
    labelfont=bf,
    skip=6pt,
    format=hang,
    justification=justified,
    singlelinecheck=false
}
\captionsetup[subfigure]{font=footnotesize, labelfont=bf}

% Table settings
\RequirePackage{booktabs}
\renewcommand{\arraystretch}{1.05}

% Hyperref - must be loaded late
\RequirePackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue!70!black,
    citecolor=blue!70!black,
    urlcolor=blue!70!black,
    pdfborder={0 0 0}
}

% Additional utilities
\RequirePackage{xcolor}
\RequirePackage{microtype}
\RequirePackage{nicefrac}

% Math operators
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\newcommand{\E}{\mathbb{E}}
\newcommand{\R}{\mathbb{R}}

% Footnote styling
\renewcommand{\footnoterule}{%
    \kern -3pt
    \hrule width 1.5in height 0.4pt
    \kern 2.6pt
}

\endinput